<section class="content-panel" style="overflow-x:hidden; position: relative;">

    <input type="hidden" name="current-date" value="{{ date|app_datetime }}">

    {% for resource in resources %}
        <input type="hidden" class="app-resource-ids" value="{{ resource.id }}">
    {% endfor %}

    <div id="calendar-widget-carousel" class="carousel slide" data-ride="carousel" data-wrap="false"
         data-interval="false">

        <!-- Wrapper for slides -->
        <div class="carousel-inner" role="listbox">

            {% for dt in dates %}

                <div class="item {{ dt==date ? 'active' : '' }}" data-date="{{ dt|app_date_moment }}">

                    <h2><i class="fa fa-calendar" aria-hidden="true"></i>&nbsp;{{ dt|app_date_and_week_day }}</h2>

                    <table width="100%" class="appt-list">

                        {% set resCounter = 0 %}
                        {% set appointmentsExist = false %}

                        {% set intervals = eventUtils.getWorkDayIntervals(dt) %}
                        {% for interval in intervals %}

                            {% set intervalEvents = eventUtils.intervalAppointments(interval['start'],interval['end']) %}
                            {% if intervalEvents|length>0 %}
                                {% set resCounter = resCounter+1 %}
                                {% set appointmentsExist = true %}
                                <tr>

                                    {% for resource in resources %}

                                        {% set resourceIntervalEvent = eventUtils.intervalAppointments(interval['start'],interval['end'],resource) %}

                                        {% if resourceIntervalEvent %}

                                            {% set serialized = eventUtils.serializeEvent(resourceIntervalEvent) %}

                                            <td width="50%" data-event-id="{{ resourceIntervalEvent.id }}"
                                                data-resource-id="{{ resource.id }}"
                                                style="{{ (resourceIntervalEvent.treatment.calendarColour ? "background: "~resourceIntervalEvent.treatment.calendarColour~" !important;":"")|raw }}"
                                                data-resource-counter="{{ resCounter }}"
                                                class="appt-item cell-event app-appointment-view"
                                                data-entity-id="{{ app_hash(resourceIntervalEvent,eventClass) }}">

                                                <div class="appt-info">
                                                    <span class="time">{{ resourceIntervalEvent.start|app_time_calendar_widget }}</span>
                                                    <span class="name">{{ resourceIntervalEvent.patientsList }}</span>
                                                </div>
                                                <div class="appt-meta" style="color: {{ serialized.textColor|raw }}; ">
                                                    {{ resourceIntervalEvent.treatment }}
                                                    <span class="duration">{{ resourceIntervalEvent.durationInMinutes }} {{ 'app.event.minute_short'|trans }}</span>

                                                    {% for ap in resourceIntervalEvent.appointmentPatients %}
                                                        {% if ap.patient.alerts|length %}
                                                            {% for alert in resourceIntervalEvent.patient.alerts %}
                                                                <div class="appt-alert"
                                                                     style="color: {{ serialized.textColor|raw }} !important;">
                                                                    <a href="#" class="app-patient-alert-edit"
                                                                       style="color: {{ serialized.textColor|raw }} !important;"
                                                                       data-entity-id="{{ app_hash(alert) }}">{{ alert }}</a>
                                                                </div>
                                                            {% endfor %}
                                                        {% endif %}
                                                    {% endfor %}

                                                </div>
                                            </td>
                                        {% else %}
                                            <td width="50%" data-resource-id="{{ resource.id }}"
                                                data-resource-counter="{{ resCounter }}" class="cell-empty">&nbsp;
                                            </td>
                                        {% endif %}

                                    {% endfor %}

                                </tr>

                            {% endif %}

                        {% endfor %}

                        {% if appointmentsExist == false %}
                            <tr>
                                <td class="appt-item" align="center" valign="middle">
                                    <br/>
                                    {{ 'app.appointment.no_on_date'|trans }}
                                    <br/>
                                </td>
                            </tr>
                        {% endif %}

                    </table>

                </div>

            {% endfor %}

        </div>

    </div>

    <div class="date-scroll" style="position: absolute; top: 0px; left: 0px; width: 100%;">
        <a class="scroll-prev" href="#calendar-widget-carousel" data-slide="prev"
           style="margin: 20px 0px 0px 20px;"></a>
        <a class="scroll-next" href="#calendar-widget-carousel" data-slide="next"
           style="margin: 20px 20px 0px 0px;"></a>
    </div>

</section>
