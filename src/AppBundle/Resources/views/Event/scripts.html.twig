<script>

    function redirectToCal() {
        var calUrl = Routing.generate('calendar_index', {}, true);
        if (window.location.href !== calUrl) {
            window.location.href = calUrl;
        }
    }

    function eventEdit(appointmentId, parentModal, requestData) {

        var eventEditModal = function (appointmentId) {
            loaderShow();

            if (typeof requestData === 'undefined') {
                requestData = {};
            }

            var url = Routing.generate('event_update', {'id': appointmentId});

            $.get(url, requestData, function (data) {
                data = $.parseJSON(data);
                if (typeof data.form !== 'undefined') {

                    $('#app-modal-event .modal-title').html('{{ 'app.event.edit'|trans }}');

                    {% if rescheduleEventId is defined %}

                    $('#app-modal-event .modal-title').html('{{ 'app.event.reschedule_full'|trans }}');

                    $("body").on("click", "#app-modal-event button[data-dismiss='modal']", function (e) {
                        eventView('{{ rescheduleEventId }}', $("#app-modal-event"));
                    });

                    {% endif %}

                    $('#app-modal-event .modal-body').html(data.form);
                    ajaxModalButtons($('#app-modal-event'));
                    $('#app-modal-event').modal('show');
                }
                loaderHide();
            });
        };

        if (typeof parentModal !== 'undefined') {
            if ($(parentModal).length) {
                $(parentModal).modal('hide');
                $(parentModal).on('hidden.bs.modal', function (e) {
                    $(parentModal).off('hidden.bs.modal');
                    eventEditModal(appointmentId);
                });
                return;
            }
        }

        eventEditModal(appointmentId);
    }

    function eventCreate(date, route, routeParams, titleLabel) {
        loaderShow();

        if (typeof date !== 'undefined') {
            routeParams.date = date;
        } else {
            if (typeof $('#app-modal-event').attr('data-initial-date') !== 'undefined') {
                routeParams.date = $('#app-modal-event').attr('data-initial-date');
            }
        }

        if (typeof routeParams.resourceId == 'undefined') {
            if (typeof $('#app-modal-event').attr('data-initial-resource') !== 'undefined') {
                routeParams.resourceId = $('#app-modal-event').attr('data-initial-resource');
            }
        }

        if (typeof routeParams.date !== 'undefined') {
            $('#app-modal-event').attr('data-initial-date', routeParams.date);
        }

        if (typeof routeParams.resourceId !== 'undefined') {
            $('#app-modal-event').attr('data-initial-resource', routeParams.resourceId);
        }

        var url = Routing.generate(route, routeParams);

        $.get(url, {}, function (data) {
            data = $.parseJSON(data);
            if (typeof data.form !== 'undefined') {
                $('#app-modal-event .modal-title').html(titleLabel);
                $('#app-modal-event .modal-body').html(data.form);
                ajaxModalButtons($('#app-modal-event'));
                $('#app-modal-event').modal('show');
            }
            loaderHide();
        });
    }

    function eventView(eventId, parentModal) {

        var eventViewModal = function (eventId) {
            loaderShow();

            var url = Routing.generate('event_view', {
                'id': eventId
            });

            $.get(url, {}, function (data) {
                $('#app-modal-event-view').html(data);
                $('#app-modal-event-view').modal('show');
                loaderHide();
            });
        };

        if (typeof parentModal !== 'undefined') {
            if ($(parentModal).length) {
                $(parentModal).modal('hide');
                $(parentModal).on('hidden.bs.modal', function (e) {
                    $(parentModal).off('hidden.bs.modal');
                    eventViewModal(eventId);
                });
                return;
            }
        }

        eventViewModal(eventId);
    }

</script>
