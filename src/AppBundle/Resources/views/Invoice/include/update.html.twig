<section class="detail-section">
    {% set status %}
        {% include "@App/Invoice/include/statusBadge.html.twig" %}
    {% endset %}

    {{ macros.detailRow('app.invoice.number'|trans,entity.name, true) }}
    {{ macros.detailRow('app.invoice.status'|trans,status, true) }}
</section>

<section class="detail-section">
    <h3>{{ 'app.general'|trans }}</h3>

    <div class="hidden">
        {{ form_row(form.name) }}
    </div>
    <div class="row no-gutter">
        <div class="col-sm-3 date-selectors">
            {{ form_row(form.date) }}
        </div>
        <div class="col-sm-4">
            {{ form_row(form.dueDate) }}
        </div>
        <div class="col-sm-3">
            {{ form_row(form.reminderFrequency) }}
        </div>
    </div>
</section>

<section class="detail-section">
    <h3>{{ 'app.patient.label'|trans }}</h3>
    {{ form_row(form.patient) }}
    {{ form_row(form.patientAddress) }}
</section>

<section class="detail-section">
    <h3>{{ 'app.treatment.plural_label'|trans }}</h3>
    {% include "@App/Treatment/updateInvoiceTreatmentList.html.twig" %}
</section>

<section class="detail-section">
    <h3>{{ 'app.product.plural_label'|trans }}</h3>
    {% include "@App/Product/updateInvoiceProductList.html.twig" %}
</section>

<section class="detail-section">
    <h3>{{ 'app.invoice.notes'|trans }}</h3>
    {{ form_widget(form.notes) }}
</section>

<section class="detail-section">
    <h3>{{ 'app.invoice_payment.plural_label_short'|trans }}</h3>
    {% include "@App/InvoicePayment/updateInvoicePaymentList.html.twig" %}
</section>

<script type="text/javascript">

    $(document).ready(function () {

        $('body').on('change', '#{{ form.patient.vars.id }}', function () {
            if ($(this).val()) {

                $('#{{ form.patientAddress.vars.id }}').prop('disabled', true);

                var url = Routing.generate('patient_address_view', {
                    'id': $(this).val()
                });

                $.post(url, {}, function (data) {
                    var response = jQuery.parseJSON(data);
                    $('#{{ form.patientAddress.vars.id }}').val(response.address);
                    $('#{{ form.patientAddress.vars.id }}').prop('disabled', false);
                }, 'json');
            }
        });
    })
</script>

{{ form_widget(form._token) }}
